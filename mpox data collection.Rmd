---
title: "Mpox data collection"
output: html_document
date: "2023-07-07"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(lubridate)
library(flextable)
library(zoo)
```

# Data import

```{r data}
link <- "https://raw.githubusercontent.com/owid/monkeypox/main/owid-monkeypox-data.csv"
download.file(link, "mpox-owid.csv")
data <- read_csv("mpox-owid.csv")
world_data <- data |> filter(iso_code == "OWID_WRL", date >= "2023-01-01") |> mutate(new_cases_ma = rollmean(new_cases, k = 7, fill = NA))
```

## Mpox World Plot

```{r world, echo=FALSE}
ggplot(data = world_data, aes(x = date, y = new_cases_ma)) + geom_line()
```

# Mpox cases in the ASEAN Region (Jan. 1 to 4 Oct, 2023)
```{r}
asean_data <- data |> filter(iso_code %in% c("BRN", "KHM", "IDN", "LAO", "PHL", "THA", "VNM", "MMR", "SGP", "MYS"), date >= "2023-01-01")
asean_data |> 
  group_by(location) |> 
  summarise(cum_cases = sum(new_cases), cum_death = sum(new_deaths), cfr = round((cum_death/cum_cases)*100, 2))
```

```{r}
asean_data |> summarise(cum_cases = sum(new_cases), cum_death = sum(new_deaths), cfr = round((cum_death/cum_cases)*100, 2))
```


```{r}
asean_data |> group_by(location) |> 
  slice(tail(row_number(), 7)) |> 
  select(1:7)
```

# Mpox cases in the Asia-Pacific region (Jan. 1 to Oct 4, 2023)
```{r}
ap_data <- data |> filter(iso_code %in% c("AUS", "IND", "JPN", "NPL", "NZL", "CHN", "KOR", "LKA"), date >= "2023-01-01")
ap_data |> group_by(location) |> 
  summarise(cum_cases = sum(new_cases), cum_death = sum(new_deaths), cfr = round((cum_death/cum_cases)*100, 2))
```

```{r}
ap_data |> summarise(cum_cases = sum(new_cases), cum_death = sum(new_deaths), cfr = round((cum_death/cum_cases)*100, 2))
```

```{r}
ap_data |> group_by(location) |> 
  slice(tail(row_number(), 7)) |> 
  select(1:7)
```

# Top 5 countries with the most mpox cases globally (Jan. 1 to Oct. 2, 2023)
```{r}
data |> filter(date >= "2023-01-01", !grepl("OWID", iso_code)) |> 
  group_by(location) |> summarise(cum_cases = sum(new_cases), cum_death = sum(new_deaths)) |> 
  arrange(-cum_cases) |> top_n(5, cum_cases)
```

# Mpox cases per region
```{r}
region_data <- read_csv("mpox cases by country as of 26 September 2023.csv") |> filter(date >= "2023-01-01") |> group_by(who_region) |> 
  summarise(cum_cases = sum(new_confirmed_cases), cum_death = sum(new_deaths))
region_data
```

